import os
import sys
import time
import argparse
import xml.dom.minidom


def masscan_report(xmlpath,output,ahead):
    domx = xml.dom.minidom.parse(xmlpath)
    root = domx.documentElement
    nodelist = root.getElementsByTagName('host')
    for hosts in nodelist:
        address_node = hosts.getElementsByTagName('address')
        addr = address_node[0].getAttribute('addr')
        # print addr
        port_node = hosts.getElementsByTagName('port')
        for port in port_node:
            portid = port.getAttribute('portid')
            ipp = addr + ":" + portid
            if not ahead:
                with open(output, 'a') as f:
                    f.write(ipp + '\n')
            else:
                head = ahead+"://"+ipp
                with open(output, 'a') as f:
                    f.write(head + '\n')

def main():
    parse = argparse.ArgumentParser(description="Masscan Report Sort out")
    parse.add_argument("-i","--input",help="Xml Path")
    parse.add_argument("-o","--output",help="Output file name",default="ip.txt")
    parse.add_argument("-a","--addhead",help="add head to head://ip:port")
    args = parse.parse_args()
    xmlpath = args.input
    output =  args.output
    ahead  = args.addhead
    if not args.input:
        parse.print_help()
        sys.exit(0)
    masscan_report(xmlpath=xmlpath,output=output,ahead=ahead)

if __name__ == '__main__':
    main()

